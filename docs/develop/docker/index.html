<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docker # Overview # Docker is useful because it allows you to both package and run software with all its dependencies and configuration in isolation. It also allows you (in theory) to have the same environment in development as in CI and production.
Installation # You should install via homebrew
brew cask install docker Configuration of Shared Folders # Anecdata suggests that removing some of the default shared folders can decrease CPU usage."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Docker # Overview # Docker is useful because it allows you to both package and run software with all its dependencies and configuration in isolation. It also allows you (in theory) to have the same environment in development as in CI and production.
Installation # You should install via homebrew
brew cask install docker Configuration of Shared Folders # Anecdata suggests that removing some of the default shared folders can decrease CPU usage."><meta property="og:type" content="article"><meta property="og:url" content="https://805th-Shoc.github.io/docs/develop/docker/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-02-08T15:06:45-08:00"><title>Docker | Engineering-Playbook</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.941313a023209828c887550ad1e6ffb06e03377997c980d428153b11b72ea760.js integrity="sha256-lBMToCMgmCjIh1UK0eb/sG4DN3mXyYDUKBU7Ebcup2A=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Engineering-Playbook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/>Welcome</a></li><li><a href=/docs/documentation/introduction-to-documentation/>Documentation</a><ul><li><a href=/docs/documentation/introduction-to-documentation/>Introduction to Documentation</a></li><li><a href=/docs/documentation/adr/>Architectural Decision Records</a></li><li><a href=/docs/documentation/external-resources/>External Resources</a></li></ul></li><li><a href=/docs/compliance/information-security-and-federal-compliance/>Security and Compliance</a><ul><li><a href=/docs/compliance/authorization-to-operate/>Authorization to Operate</a></li><li><a href=/docs/compliance/risk-management-framework/>Risk Management Framework</a></li></ul></li><li><a href=/docs/project_management/phases-of-an-agile-project/>Project Management</a><ul><li><a href=/docs/project_management/phases-of-an-agile-project/>Phases of an Agile Project</a><ul><li><a href=/docs/project_management/agile-project-discovery-phase/>Discovery Phase</a></li><li><a href=/docs/project_management/agile-project-prototyping-phase/>Prototyping Phase</a></li><li><a href=/docs/project_management/agile-project-beta-phase/>Beta Phase</a></li><li><a href=/docs/project_management/agile-project-go-live/>Go Live</a></li><li><a href=/docs/project_management/agile-project-hand-off/>Hand Off</a></li></ul></li><li><a href=/docs/project_management/the-steel-cable/>The Steel Cable</a></li><li><a href=/docs/project_management/definition-of-done/>Definition of Done</a></li><li><a href=/docs/project_management/accessibility-standards/>Accessibility Standards</a></li></ul></li><li><a href=/docs/develop/tools-and-practice/>Devloping</a><ul><li><a href=/docs/develop/tools-and-practice/>Tools and Practice</a></li><li><a href=/docs/develop/bugs/>Defects/Bugs</a></li><li><a href=/docs/develop/intro-to-ci-cd/>CI/CD</a><ul><li><a href=/docs/develop/intro-to-ci-cd/>Intro to CI/CD</a></li><li><a href=/docs/develop/standard-delivery-pipeline/>Standard Delivery Pipeline</a></li></ul></li><li><a href=/docs/develop/code-reviews/>Code Reviews</a><ul><li><a href=/docs/develop/great-code-brings-happiness/>Great Code Brings Happiness</a></li><li><a href=/docs/develop/best-practices-for-submitting-pull-requests/>Best Practices for Submitting a Pull Request</a></li></ul></li><li><a href=/>Command Line Tools</a><ul><li><a href=/docs/develop/direnv/>direnv</a></li><li><a href=/docs/develop/docker/ class=active>Docker</a></li></ul></li><li><a href=/docs/develop/configuration/>Configuration</a></li><li><a href=/docs/develop/development-cycle/>Development Cycle</a></li><li><a href=/docs/develop/editors-ides-debuggers/>Editors, IDEs and Debuggers</a></li><li><a href=/docs/develop/growth/>Growth</a></li><li><a href=/docs/develop/health-checks/>Health Checks</a></li><li><a href=/docs/develop/programming-languages/>Programming Languages</a><ul><li><a href=/docs/develop/programming-languages-shell/>Shell Programming</a></li><li><a href=/docs/develop/programming-languages-golang/>Golang</a></li><li><a href=/docs/develop/programming-languages-python/>Python</a></li></ul></li><li><a href=/>Learning Resources</a></li><li><a href=/>Open Source</a></li><li><a href=/>Pair Programming</a></li><li><a href=/>Technical Design</a></li><li><a href=/docs/develop/source-control/>Source Control</a></li><li><a href=/>Leadership</a></li></ul></li><li><a href=/docs/infrastructure/>Infrastructure</a><ul><li><a href=/>IaC</a></li></ul></li></ul><br><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/805th-Shoc/805th-Shoc.github.io target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Docker</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#docker>Docker</a></li><li><a href=#overview>Overview</a><ul><li><a href=#installation>Installation</a><ul><li><a href=#configuration-of-shared-folders>Configuration of Shared Folders</a></li><li><a href=#configuration-of-storage-driver>Configuration of Storage Driver</a></li><li><a href=#configuration-of-disk-image>Configuration of Disk Image</a></li><li><a href=#configuration-of-resources>Configuration of Resources</a></li></ul></li><li><a href=#volume-mount-performance>Volume Mount Performance</a></li><li><a href=#inspecting-the-docker-virtual-machine>Inspecting the Docker Virtual Machine</a></li><li><a href=#inspecting-container-resources>Inspecting Container Resources</a></li><li><a href=#cleaning-up>Cleaning Up</a></li><li><a href=#docker-configuration>Docker Configuration</a><ul><li><a href=#keybindings>Keybindings</a></li><li><a href=#credentials-store>Credentials Store</a></li></ul></li><li><a href=#additional-resources>Additional Resources</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=docker>Docker
<a class=anchor href=#docker>#</a></h1><h1 id=overview>Overview
<a class=anchor href=#overview>#</a></h1><p>Docker is useful because it allows you to both package and run software with all its dependencies and configuration in isolation. It also allows you (in theory) to have the same environment in development as in CI and production.</p><h2 id=installation>Installation
<a class=anchor href=#installation>#</a></h2><p>You should install via homebrew</p><pre tabindex=0><code>brew cask install docker
</code></pre><h3 id=configuration-of-shared-folders>Configuration of Shared Folders
<a class=anchor href=#configuration-of-shared-folders>#</a></h3><p>Anecdata suggests that removing some of the default shared folders can decrease CPU usage. Usually you only need to share volumes under your home directory. Open the docker for mac preferences, then select &ldquo;File Sharing&rdquo; and then remove <code>/Volumes</code> and <code>/private</code>. You may also find improvements removing <code>/Users</code> and replacing it with <code>/Users/YOUR_USERNAME_GOES_HERE</code>.</p><h3 id=configuration-of-storage-driver>Configuration of Storage Driver
<a class=anchor href=#configuration-of-storage-driver>#</a></h3><p>If you&rsquo;ve been running Docker for Mac for some time, make sure you are using the <code>overlay2</code> storage driver.</p><pre tabindex=0><code>$ docker info |grep Storage
Storage Driver: overlay2
</code></pre><p>If you don&rsquo;t see overlay2, upgrading to the latest version will add that support, but you would need to recreate all of your docker data to utilize it. The <code>Reset</code> bomb should do it.</p><h3 id=configuration-of-disk-image>Configuration of Disk Image
<a class=anchor href=#configuration-of-disk-image>#</a></h3><p>If you&rsquo;ve been running Docker for Mac for some time, make sure you are using the <code>raw</code> disk image format and not <code>qcow2</code>. Open Docker for Mac preferences and select <code>Disk</code>. Make sure the image ends with <code>Docker.raw</code>.</p><h3 id=configuration-of-resources>Configuration of Resources
<a class=anchor href=#configuration-of-resources>#</a></h3><p>Because docker uses a Virtual Machine under the hood on macOS, you can choose the maximum number of resources it is allowed to use. In the preferences under Advanced, you can select how many CPUs to assign, how much memory to assign, and how much swap to give the VM.</p><p>See also
<a href=https://docs.google.com/document/d/17ZiQC1Tp9iH320K-uqVLyiJmk4DHJ3c4zgQetJiKYQM/edit>Understanding memory usage in Docker Desktop on Mac</a> by the docker developers.</p><h2 id=volume-mount-performance>Volume Mount Performance
<a class=anchor href=#volume-mount-performance>#</a></h2><p>Synchronizing the data between the host (your Mac) and the container can be resource intensive and/or slow. Read about the
<a href=https://docs.docker.com/docker-for-mac/osxfs-caching/>performance tuning options</a> to see if they might apply to the conditions in your project.</p><h2 id=inspecting-the-docker-virtual-machine>Inspecting the Docker Virtual Machine
<a class=anchor href=#inspecting-the-docker-virtual-machine>#</a></h2><p>If you are having performance problems or are just curious, you can run commands inside the Virtual Machine with</p><pre tabindex=0><code>docker run --rm=true -it --privileged --pid=host \
    justincormack/nsenter1 /usr/bin/top
</code></pre><h2 id=inspecting-container-resources>Inspecting Container Resources
<a class=anchor href=#inspecting-container-resources>#</a></h2><p>To get a top like report of what your containers are doing</p><pre tabindex=0><code>docker stats
</code></pre><h2 id=cleaning-up>Cleaning Up
<a class=anchor href=#cleaning-up>#</a></h2><p>To see where all your disk space is going:</p><pre tabindex=0><code>docker system df
</code></pre><p>To remove stopped containers, dangling images, the build cache and unused networks:</p><pre tabindex=0><code>docker system prune
</code></pre><p>See
<a href=https://docs.docker.com/engine/reference/commandline/system_prune/>the docker system prune documentation</a> for more options like pruning volumes</p><h2 id=docker-configuration>Docker Configuration
<a class=anchor href=#docker-configuration>#</a></h2><p>You can configure all sorts of defaults in the
<a href=https://docs.docker.com/engine/reference/commandline/cli/#configuration-files>docker config.json</a>.</p><h3 id=keybindings>Keybindings
<a class=anchor href=#keybindings>#</a></h3><p>If you dislike the default detach keybindings of CTRL-p CTRL-q, you can override it in config.json with something like:</p><pre tabindex=0><code>{
  &#34;detachKeys&#34;: &#34;ctrl-@,ctrl-[&#34;
}
</code></pre><h3 id=credentials-store>Credentials Store
<a class=anchor href=#credentials-store>#</a></h3><p>You can store docker credentials in an
<a href=https://docs.docker.com/engine/reference/commandline/login/#credentials-store>external credentials store</a>.</p><p>On macOS, the keychain will be used by default, but if you need/want to store shared credentials,
<a href=https://www.passwordstore.org/>pass</a> can be used.</p><h2 id=additional-resources>Additional Resources
<a class=anchor href=#additional-resources>#</a></h2><p>If you would like to dig deeper into how Docker works, how it isolates code from the host machine, and related ramifications a good place to start are the articles listed below.</p><ul><li><a href=https://docs.docker.com/get-started/>Official Docker Getiting Started Guide</a></li><li><a href=https://www.linuxjournal.com/content/weekend-reading-containers>Linux Journal Weekend Reading Containers</a><ul><li>Particularly the articles Everything You Need to Know about Linux Containers Part I and II</li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/805th-Shoc/805th-Shoc.github.io/commit/68107e13639aa3571776ec70bc74c1fcf0a5a6f6 title='Last modified by Rev. Richard E. Baker | February 8, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>February 8, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/805th-Shoc/805th-Shoc.github.io///content/docs/develop/docker.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#docker>Docker</a></li><li><a href=#overview>Overview</a><ul><li><a href=#installation>Installation</a><ul><li><a href=#configuration-of-shared-folders>Configuration of Shared Folders</a></li><li><a href=#configuration-of-storage-driver>Configuration of Storage Driver</a></li><li><a href=#configuration-of-disk-image>Configuration of Disk Image</a></li><li><a href=#configuration-of-resources>Configuration of Resources</a></li></ul></li><li><a href=#volume-mount-performance>Volume Mount Performance</a></li><li><a href=#inspecting-the-docker-virtual-machine>Inspecting the Docker Virtual Machine</a></li><li><a href=#inspecting-container-resources>Inspecting Container Resources</a></li><li><a href=#cleaning-up>Cleaning Up</a></li><li><a href=#docker-configuration>Docker Configuration</a><ul><li><a href=#keybindings>Keybindings</a></li><li><a href=#credentials-store>Credentials Store</a></li></ul></li><li><a href=#additional-resources>Additional Resources</a></li></ul></li></ul></nav></div></aside></main></body></html>